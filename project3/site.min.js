/*! project3 2018-06-28 */

function Buttons(t){for(var e=$(t+" div"),n=e.find("button"),r=0;r<n.length;r++){var o=$(n.get(r)),s=o.val();this.installListener(r,o,s)}var i=e.parent().siblings(t).children("p").children("input");this.resetListener(i)}function parse_json(e){try{var t=$.parseJSON(e)}catch(t){throw"JSON parse error: "+e}return t}Buttons.prototype.installListener=function(t,e,n){var r=this;e.mousedown(function(){event.preventDefault(),e.parent().addClass("pressed"),$.ajax({url:"post/enigma-js.php",data:{key:n},method:"POST",success:function(t){var e=parse_json(t);r.presentRotors(e.rotors),r.lightOff(),r.lightOn(e.lit)},error:function(t,e,n){}})}),e.mouseup(function(){event.preventDefault(),e.parent().removeClass("pressed")}),e.click(function(){event.preventDefault()})},Buttons.prototype.resetListener=function(t){var n=this;t.click(function(){event.preventDefault(),$.ajax({url:"post/enigma-js.php",data:{reset:!0},method:"POST",success:function(t){var e=parse_json(t);n.presentRotors(e.rotors),n.lightOff()},error:function(t,e,n){}})})},Buttons.prototype.presentRotors=function(t){$("div .rotors").html(t)},Buttons.prototype.lightOn=function(t){$("div .light-"+t).addClass("light-on")},Buttons.prototype.lightOff=function(){$("div .light-on").removeClass("light-on")};